{"version":3,"sources":["../../src/datasource/query_editor.js"],"names":[],"mappings":"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","file":"query_editor.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\n\nimport _ from 'lodash';\n\nclass SnapQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv) {\n    super($scope, $injector);\n\n    this.uiSegmentSrv = uiSegmentSrv;\n    this.removeMetricOption = this.uiSegmentSrv.newSegment({fake: true, value: '-- remove metric --'});\n\n    this.target.mode = this.target.mode || 'Watch Task';\n    this.target.taskName = this.target.taskName || 'select task';\n    this.target.taskId = this.target.taskId || '';\n    this.target.metrics = this.target.metrics || [];\n\n    this.taskSegment = this.uiSegmentSrv.newSegment({\n      value: this.target.taskName\n    });\n\n    if (this.target.taskName === 'select task') {\n      this.taskSegment.fake = true;\n    }\n\n    this.metricSegments = this.target.metrics.map(item => {\n      return this.uiSegmentSrv.newSegment({value: item.namespace, cssClass: 'last'});\n    });\n\n    this.metricSegments.push(this.uiSegmentSrv.newPlusButton());\n  }\n\n  getModes() {\n    return Promise.resolve([\n        this.uiSegmentSrv.newSegment({value: 'Watch Task'}),\n        this.uiSegmentSrv.newSegment({value: 'Define Task'}),\n    ]);\n  }\n\n  getTasks() {\n    return this.datasource.getTasks().then(tasks => {\n      this.taskMap = {};\n\n      return tasks.map(task => {\n        this.taskMap[task.name] = task;\n\n        return this.uiSegmentSrv.newSegment({value: task.name});\n      });\n    });\n  }\n\n  taskChanged() {\n    var task = this.taskMap[this.taskSegment.value];\n    this.target.taskName = task.name;\n    this.target.taskId = task.id;\n    this.panelCtrl.refresh();\n  }\n\n  getMetricSegments(segment) {\n    return this.datasource.getMetrics().then(metrics => {\n      var elements = metrics.map(item => {\n        return this.uiSegmentSrv.newSegment({value: item.value});\n      });\n\n      if (!segment.fake) {\n        elements.unshift(_.clone(this.removeMetricOption));\n      }\n\n      return elements;\n    });\n  }\n\n  metricSegmentChanged(segment, index) {\n    if (segment.value === this.removeMetricOption.value) {\n      this.metricSegments.splice(index, 1);\n    } else {\n      if (segment.type === 'plus-button') {\n        segment.type = '';\n      }\n\n      if ((index+1) === this.metricSegments.length) {\n        this.metricSegments.push(this.uiSegmentSrv.newPlusButton());\n      }\n    }\n\n    this.target.metrics = this.metricSegments.reduce((memo, item) => {\n      if (!item.fake) {\n        memo.push({namespace: item.value});\n      }\n      return memo;\n    }, []);\n  }\n\n  deleteTask() {\n    this.datasource.deleteTask(this.target.taskId).then(() =>  {\n      this.target.taskId = null;\n      this.target.taskName = \"\";\n      this.taskSegment.value = 'select task';\n      this.taskSegment.html = 'select task';\n      this.taskSegment.fake = true;\n    });\n  }\n}\n\nSnapQueryCtrl.templateUrl = 'datasource/query_editor.html';\nexport {SnapQueryCtrl};\n"]}